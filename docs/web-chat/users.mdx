---
sidebar_position: 40
title: Users
description: "Track and manage users on Web Chat."
---

import {
  Admonition,
  CodeBlock,
  Tabs,
  TabItem,
  LatestSdkVersion,
  Centered,
  Image,
  Intro,
  SideBySide,
  DownloadButton,
  Steps,
  Step,
} from "@site/src/components/forDocs";

# Users {#users}

<Intro>

Track and manage users on Web Chat.

</Intro>

## Manage users with the legacy method {#identify-and-manage-users}

<Admonition type="warning" title="Before you proceed">

This section describes how you can integrate users with the legacy method. For integrating with the
new Identity System, please refer to: [Managing users with the Identity System](#managing-users-with-the-identity-system).

We recommend using the new Identity System if you require faster context collection, an easier agent experience, and enhanced security and spam protection.

</Admonition>


### Logged in users {#logged-in-users}

#### Overview

A logged-in user uses Web Chat after providing your website with a username and password. If your website has logged-in users, we **highly recommend passing user identifiers (`userId` and/or `userEmail`)** with the `helpshiftConfig` object at the time of initialization. This helps your Agents provide a personalized support experience to your users, no matter which device or browser your end users are using. Passing the user identifiers to Web Chat also ensures ensures that a user's conversations are available only to them when they log in.

#### What to provide as user identifiers

You can set the `userId` and/or `userEmail` to identify your users. We highly recommend using a `userId` to identify your users. **If you use emails to identify your users, you must pass them with the `userEmail` field with the `helpshiftConfig` object**.

The following rules apply when you use both, userId and userEmail.

- When looking the user up in the Helpshift system, the priority of `userId` is higher than that of `userEmail`.
- When the `userId` matches that of an existing user, the existing user's email gets updated, if the email is provided.
- When the `userEmail` matches that of an existing user, the following rules apply:
  - If the `userId` doesn't exist for the user matched by the email, then the `userId` would be added to that user, if a `userId` is provided.
  - If the `userId` already exists for the user matched by the email, then a new user would be created, if a different `userId` is provided.

#### How to provide user's information

The helpshiftConfig object accepts the following parameters:

| Parameter       | Description                                                                                                                                                                                                                                                                                                                                                                  | Important considerations                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| --------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `userName`      | A user's name. Provide the name you'd like the Agents to use to address the user. If you don't have the user's name in your systems, you may leave it blank. The Identity Bot, if enabled, will ask the user for their name. If you provide a value for the name, then the Identity Bot will not ask the user for their name again.                                          | Max length â€“ 255 characters. Values longer than this will be truncated.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| `userId`        | A user's unique identifier. The userId values must be unique for your users, i.e. you should not use the same `userId` for different users.                                                                                                                                                                                                                                  | 1. The max length is 750 characters. Values longer than this will result in the creation of an anonymous user.<br/>2. Leading/trailing spaces are not allowed. Spaces within the `userId` value are allowed, though. userId values with leading/trailing spaces will result in the creation of an anonymous user.<br/>3. The `userId` value is case-sensitive, e.g. "1abc" is different than "1ABC".<br/>4. Do not provide an email address as the `userId`. If you use email addresses to identify users, provide them with `userEmail`.<br />5. If you are using `userId` as well as `userEmail`, ensure that `userId` is present in all subsequent pages. Providing just the email may return another user's conversations, if multiple profiles have the same email. |
| `userEmail`     | A user's email address. If you don't know the user's email, you may leave it blank. The Identity Bot, if enabled, will ask the user for their email. If you provide a value for the email, then the Identity Bot will not ask the user for their email again.                                                                                                                | 1. The email should be in a valid format, e.g. "foobar@example.com". Invalid emails will result in the creation of an anonymous user.<br />2. Leading/trailing spaces are not allowed. Emails with leading/trailing spaces will result in the creation of an anonymous user.<br />3. The email value is case insensitive, e.g. "foobar@example.com" is same as "FOObar@Example.Com".                                                                                                                                                                                                                                                                                                                                                                                     |
| `userAuthToken` | A user authentication token is generated via Hash Based Message Authentication Code (HMAC) using SHA256. You should provide a `userAuthToken` if you want to ensure that 3rd parties cannot file issues on behalf of your users or update their properties. You can find more details under the [Verifying the identity of users section](#verifying-the-identity-of-users). | A valid `userAuthToken` should be provided in order to ensure your users can file issues. Learn more [here](https://support.helpshift.com/hc/en/13-helpshift-technical-support/faq/880-user-identity-verification-how-do-i-configure-the-endpoint-and-my-app-web-chat-widget-for-user-identity-verification/)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |

<Admonition type="info" title="Note">

- In order to create a logged-in user in Helpshift, the use of either `userId` or `userEmail` is required.
- All the parameter values should be of type string. Integer and decimal values are invalid.

</Admonition>

##### Example Embed Code

```javascript
var PLATFORM_ID = "foo",
  DOMAIN = "bar";

window.helpshiftConfig = {
  platformId: PLATFORM_ID,
  domain: DOMAIN,
  platformId: PLATFORM_ID,
  domain: DOMAIN,
  userId: "captain_planet",
  userEmail: "captain@example.com",
  userName: "Captain Planet",
  userAuthToken: "ab+dKOFgxspi3ARXSa/zSdN4wFrU6CQu3hJzHQtXYRI",
};
```

### Logging the users out {#logging-the-users-out}

Once a user logs out from your website, you should stop sending the user identifiers with the `helpshiftConfig` object to ensure that other users can't view this user's conversations. After you log a user out, only the conversations started by anonymous users using that specific browser will be visible.

### Anonymous Users {#anonymous-users}

#### Overview

An anonymous user is one who accesses Web Chat without providing your website with a username and password. If a user identifier is not passed with the `helpshiftConfig` object at the time on initialization, Helpshift assumes that the end user is an anonymous user, i.e. is not currently logged in. Similarly, if a user identifier is passed with the `helpshiftConfig` object, then the end user is assumed to be a logged-in user.

If your use-case involves multiple logged-in or anonymous users using the same device, ideally you wouldn't want the conversations to be shared across logins. In this case, you should use the `clearAnonymousUserOnLogin` option with the `helpshiftConfig` object at the time of initialization. If you set `clearAnonymousUserOnLogin` to `true`, then anonymous users will be cleared from Web Chat whenever a new user logs in. Once cleared, such users, and their conversations, are not fetched again.

<Admonition type="info" title="Note">

The anonymous user will be cleared from Web Chat after 7 days to make sure that the conversations by anonymous users do not persist on the browsers forever.

</Admonition>

##### Example Embed Code

```javascript
var PLATFORM_ID = "foo",
  DOMAIN = "bar";

window.helpshiftConfig = {
  platformId: PLATFORM_ID,
  domain: DOMAIN,
  userId: "piano_man",
  clearAnonymousUserOnLogin: true,
};
```

<Admonition type="info" title="Note">

The `clearAnonymousUserOnLogin` functionality does not impact the logged-in user's experience at all.

</Admonition>

## Verifying the identity of users {#verifying-the-identity-of-users}

### Configuring Identity Verification in your app {#configuring-identity-verification}

#### Overview

User Identity Verification is a security measure that verifies that all requests made from your Web Chat widget to Helpshift are coming from authentic end users. This prevents 3rd parties or hackers from impersonating your users. You can learn more about User Identity Verification and the steps to configure it [here](https://support.helpshift.com/hc/en/13-helpshift-technical-support/faq/878-user-identity-verification-what-is-user-identity-verification-and-how-do-i-set-it-up/).

In order to ensure your users are verified, you should provide a "user authentication token" with the `helpshiftConfig` object at the time of initialization. You can find the steps to generate a "user authentication token" [here](https://support.helpshift.com/hc/en/13-helpshift-technical-support/faq/880-user-identity-verification-how-do-i-configure-the-endpoint-and-my-app-web-chat-widget-for-user-identity-verification/). The "user authentication token" is an HMAC Digest, which is generated via HMAC using SHA256.

#### Sending the user authentication token to verify users' identity

You can send the "user authentication token" along with the `userAuthToken` key of the `helpshiftConfig` object. If [Identity Verification is enabled on the Helpshift Dashboard](https://support.helpshift.com/hc/en/13-helpshift-technical-support/faq/878-user-identity-verification-what-is-user-identity-verification-and-how-do-i-set-it-up/), Helpshift recalculates the unique user authentication token using the shared secret key, and compares the user authentication token sent by you to the recalculated value. If they're equal, the user's identity is verified, and the user is able to file Issues.

<Admonition type="info" title="Note">

- If the secret key is regenerated for an app on the Admin Dashboard, you should ensure you update your endpoint code as well in order to generate a valid "user authentication token". Following which, your Admins should delete the old secret key from the Dashboard in order to ensure requests using a "user authentication token" generated using the old secret key become invalid.
- If `fullPrivacy` is true, then the "user authentication token" should be generated only using the `userId`.

</Admonition>

##### Example Embed Code

```javascript
var PLATFORM_ID = "foo",
  DOMAIN = "bar";

window.helpshiftConfig = {
  platformId: PLATFORM_ID,
  domain: DOMAIN,
  userId: "captain_planet",
  userEmail: "captain@example.com",
  userName: "Captain Planet",
  userAuthToken: "ab+dKOFgxspi3ARXSa/zSdN4wFrU6CQu3hJzHQtXYRI",
};
```

### Identity Verification failure {#identity-verification-failure}

#### Overview

When making a request to Helpshift with no `userAuthToken` or an invalid `userAuthToken`, Identity Verification will fail. If Identity Verification fails, the following will hold true.

- Anonymous users (users for whom you do not provide any identifiers) are always able to file issues.
- Logged-in users (users for whom you provide an identifier such as `userId` or `userEmail`) are not able to file issues or see conversations if they are unverified. Unverified logged-in users will have the following experience:
  - The Web Chat launcher icon will not be shown when the web page is loaded.
  - The Web Chat widget will show an error (if it's opened by means of the `open` API).
- If the logged-in users are verified (i.e. a valid `userAuthToken` is provided), they are able to see their previous conversations and create new Issues. The UI for verified logged-in users looks and works exactly the same as it would if Identity Verification were turned off. Only unverified users are impacted as described above.

### Testing & Troubleshooting {#testing-and-troubleshooting}

[How do I test that I have User Identity Verification set up correctly?](https://support.helpshift.com/hc/en/13-helpshift-technical-support/faq/881-user-identity-verification-how-do-i-test-that-i-have-user-identity-verification-set-up-correctly/)

## Managing users with the Identity System {#managing-users-with-the-identity-system}

Setting up the Identity System requires some development effort, but provides many advantages over the legacy
method in the form of faster context collection, easier agent experience, and enhanced security and spam protection.

### Prerequisites

1. Ensure that the Identity System is enabled for your domain (reach out to Helpshift support if you wish to enable this)
2. Ensure that you have an endpoint set up for obtaining user JWTs on-demand (TK/TODO link KB)

### Logging in your end-users {#login-user}

In order to use the new Identity system, you need to implement the following steps:
1. Specify the `authenticateWith` parameter in `helpshiftConfig` prior to loading Web Chat
2. Ensure that `userId` and/or `userEmail` are specified in `helpshiftConfig`
3. Start listening for the `onLoginRequest` event from Helpshift
4. Obtain a JWT for the given user from your dedicated endpoint
5. Log your user in with the JWT + full privacy information

```js
window.helpshiftConfig = {
  // ... your other config values
  // Step 1
  authenticateWith: "identities",

  // Step 2
  userEmail: "<your-user-email>",
  userId: "<your-user-id>"
}

/////////////////////////////////
// Your embed script goes here //
/////////////////////////////////

// Step 3: Add the event listener
Helpshift("addEventListener", "onLoginRequest", async ({userId, userEmail}) => {

    // Step 3:
    // Note: Your implementation here may vary. This is just an example.
    const identityToken = await fetch("<your-jwt-endpoint>", {
        method: "POST",
        headers: {
          "Accept": "application/json",
          "Content-Type": "application/json"
        },
        body: JSON.stringify({userId, userEmail})
    })

    // Step 4:
    // Note: The userId/userEmail specified in the identity_token
    // MUST match the values specified in the helpshiftConfig object.
    // If they do not match, the login will be unsuccessful.
    Helpshift("login", {
      identity_token: identityToken,
      full_privacy_enabled: false // or true. Assumed false if not specified
    });
});
```

### With anonymous users {#with-anon-users}

We recommend logging in your end-user into Helpshift as early as possible, since it helps
streamline the entire support experience.

However, in the case where you have anonymous users, all you have to do is set the `authenticateWith` value,
and Helpshift will take care of generating an anonymous UID and logging your end-user in.

The `userId` and `userEmail` values can be omitted altogether or set to an empty string, `""`.

```js
window.helpshiftConfig = {
  // ... your other config values
  authenticateWith: "identities"
  // Notice that "userId" and "userEmail" are not specified here
}

/////////////////////////////////
// Your embed script goes here //
/////////////////////////////////
```

### Retroactively logging your end-user in {#retroactively-login-user}
In certain cases, your end-user may be anonymous for a short while before you log them in. In such cases, you will have to
update `helpshiftConfig` and call the `Helpshift("updateHelpshiftConfig")` API to trigger a new login.

```js
window.helpshiftConfig = {
  // ... your other config values
  authenticateWith: "identities"
  // Anonymous user since no userId/userEmail are provided
}

/////////////////////////////////
// Your embed script goes here //
/////////////////////////////////

// Register your event listener
Helpshift("addEventListener", "onLoginRequest", async ({userId, userEmail}) => {

    const identityToken = await fetch("<your-jwt-endpoint>", {
        method: "POST",
        headers: {
          "Accept": "application/json",
          "Content-Type": "application/json"
        },
        body: JSON.stringify({userId, userEmail})
    })

    Helpshift("login", {
      identity_token: identityToken,
      full_privacy_enabled: false // or true. Assumed false if not specified
    });
});

// At some point in the future, when your user logs in:
window.helpshiftConfig.userId = "<your-user-id>"
window.helpshiftConfig.userEmail = "<your-user-email>"

Helpshift("updateHelpshiftConfig")
// ^ This will trigger the onLoginRequest event.
```

### Logging out your end-users {#logout-end-users}
To log out your end-users, you can use the logout API.


```js
Helpshift("logout");
```

Note that after calling this API, Web Chat will clear any user specific data from the `helpshiftConfig`
object, and reset the chat to an anonymous user. Depending on the value of `helpshiftConfig.clearAnonymousUserOnLogin`,
this can either be the previous anonymous user or a new anonymous user.

<Admonition type="info" title="Tip">

For a better user experience, consider hiding the chat widget after the user logs out.

</Admonition>

### Optimizations

<Admonition type="info" title="Note">

Web Chat will run smoothly even without these optimizations. However, if you want to see
faster load times for Web Chat, and reduced load on your infrastructure, you may choose to implement these
optimizations.

</Admonition>

#### Send the identity_token in SSR requests {#send-identity-token-in-ssr}
If your application uses SSR, you can send the `identity_token` as part of your page load,
injecting it in the `onLoginRequest` callback directly.

_Please ensure that you do not set this value in a global variable to minimize the security risks for your
end-user._

<Admonition type="info" title="Caveat">

Helpshift fires the `onLoginRequest` event if we detect suspicious end-user activity. In such cases,
your page will provide a stale ID token, which will result in an expired support session.

A refresh of the page would allow their session to be restored.

This is usually not an issue for most end-users, but in case you want instant support session recovery, a JWT endpoint
would become necessary.

</Admonition>

#### Caching the identity_token {#caching-id-token}
We highly discourage caching the `identity_token` on the client-side since it increases the potential
attack surface for XSS. However, you may choose to cache it on the server-side, provided that the cache
is invalidated before 24 hours elapse.

### Troubleshooting and tips {#troubleshooting-and-tips}

Login failure can be detected by listening to the [`onWebChatRuntimeError` event](/web-chat/api/#on-webchat-runtime-error).
The possible reasons for login failure are cited in the [`LOGIN_FAILED` runtime errors](/web-chat/api/#login-failed).

If your login is still failing, you can investigate these other potential reasons:
1. Ensure that your JWT endpoint is generating tokens in the accepted format
2. Ensure that your JWT endpoint is signing tokens with the shared secret
3. Ensure that your JWT endpoint has an `iat` (issued_at_time) value that is NOT older than 24h
4. In case you are caching the JWT, ensure that you do not cache it for longer than 24h.