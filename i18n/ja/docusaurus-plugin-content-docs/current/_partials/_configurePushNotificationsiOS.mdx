import { Image, Admonition } from "@site/src/components/forDocs";

### Helpshiftの管理者インターフェースでHelpshiftのプッシュ通知サービスを構成する {#configure-helpshift-push-admin}

Helpshiftのシステムがユーザーにプッシュ通知を送信できるようにするには、アプリにプラットフォームとしてiOSを追加する必要があります（まだ追加していない場合）。そして、プッシュ通知オプションをクリックします。

<Image
  src="/static/books/sdkx_ios/Add-platform.png"
  width="full"
  alt="Add-platform.png"
/>

iOSのすべてのモバイルアプリおよびゲームにプッシュ通知を送信するには、Apple Push Notification Server（APNs）との認証接続を確立する必要があります。認証には、次の2つの方法があります。

1. 新しいトークンベースの方法（.p8）
2. 古い証明書ベースの方法（.p12）

### トークンベースの方法（.p8）

トークンベースの方法では、APNsとの通信にステートレスな方法を提供しているため、より高速です。証明書やプロバイダーのサーバーに関連するその他の情報をAPNsがルックアップする必要はありません。

トークンベースの.p8キーを使用する新しい方法に対応したことにより、1つのキーですべてのiOSアプリやゲームに通知を送信できるようになりました。[こちら](https://developer.apple.com/documentation/usernotifications/setting_up_a_remote_notification_server/establishing_a_token-based_connection_to_apns)で説明されているように、.p8キーはAppleデベロッパアカウントを介して生成することができます。

<Image
  src="/static/books/sdkx_ios/p8-configure.png"
  width="full"
  alt="p8-configure.png"
/>

.p8キーを使用してiOSのプッシュ通知を設定する手順は、以下の通りです。

1. 「設定」に移動し、「**アプリの設定**」セクションに移動して構成を行うアプリを選択します。

2. 「アプリの設定」ページで、アプリ内SDKの隣にある「**構成**」オプションをクリックします。

3. 「アプリ内SDKの構成」ページで、「プッシュ通知」セクションに移動します。

4. 「Apple Push Notification Service」のトグルが有効になっていない場合には、有効にします。トグルが初めて有効化された場合、アプリはデフォルトで.p8キーによる認証の種類を選択します。

5. .p8キーをアップロードして、必要な情報を入力します。

6. APNsのプッシュモード（開発/本番）を選択します。

7. 「**保存して公開**」をクリックして変更を保存します。

<Admonition type="info" title="注意">
  認証の種類で.p12を選択し、詳細情報を入力することで、必要に応じて.p8キー方式から
.p12証明書方式へと切り替えることもできます。
</Admonition>

### 証明書ベースの方法（.p12）

Appleのポータルサイトで、後でHelpshiftに提供するAPNs用の証明書を生成する必要があります。これによりHelpshiftはユーザーにプッシュ通知を送信できるようになります。Appleは、古いタイプの証明書からApple Push Notification service SSLへの移行を実施しました。Apple Push Notification認証キーを作成する方法もありますが、Helpshiftではまだサポートされていません。また、まだ有効期限が切れていない古いタイプの証明書を持っている可能性もあるかと思われますが、これもHelpshiftでサポートされています。

#### Appleは、Apple Push Notification service SSLに2つのバリエーションを用意しています。 {#push-notification-configuration}

- Apple Push Notification service SSL（サンドボックス）
- Apple Push Notification service SSL（サンドボックスおよび本番）

証明書を作成したら、ダウンロードします。証明書をダブルクリックして、キーチェーンアクセスアプリケーションにインポートします。キーチェーンアクセスアプリケーションで先ほど追加した証明書を右クリックし、「.p12形式でエクスポート」をクリックします。Helpshiftでは空のパスワードは受け付けておりませんので、証明書をエクスポートする際にパスワードを入力してください。（開発用の秘密鍵がキーチェーンアクセスに存在しない場合、.p12形式でエクスポートできないことにご注意ください。）

エクスポートの後は、ログインしてHelpshift管理者パネルでアプリ内の.p12ファイルをアップロードします。.p12形式へのエクスポートを行った際に使用したものと同じパスワードを入力してください。

APNs証明書を作成する際に使用したものと同じバンドル識別子をアプリで使用する必要があることにご注意ください。

<Image
  src="/static/books/sdkx_ios/Add-certificate.png"
  width="full"
  alt="Add-certificate.png"
/>

バッジ送信の有無に加えて、通知を処理するためにアプリにバンドルするカスタム音声を用意している場合には、音声アラートを構成することができます。保存すれば設定完了です。

#### 開発（サンドボックス）モードと本番モードの比較

Xcodeからアプリをビルドして実行すると、アプリは開発（サンドボックス）モードに設定されます。このモードでHelpshiftからのプッシュ通知をテストする場合、上記2つの証明書タイプのいずれかをアップロードする際に、「開発モード」を選択していることをご確認ください。

アプリを公開してApp Storeからダウンロードすると、アプリは本番モードになります。本番モードでHelpshiftからのプッシュ通知をテストするには、「Apple Push Notification service SSL（Sandbox & Production）」タイプの証明書をアップロードする際に「本番モード」を選択していることをご確認ください。サンドボックスモードの証明書は、本番環境では動作しません。

サンドボックスと本番アプリの両方に同じ証明書を使用することは、サポートされておりません。このような場合には、ダッシュボード上に2つのアプリを作成し、1つを「本番モード」に、そしてもう1つを「開発モード」に設定することをお勧めします。テスト中は、開発モードのアプリの認証情報を使用してください。公開の準備ができたら、認証情報を本番レベルのアプリのもので置き換えてください。

<Admonition type="info" title="注意">

プッシュ証明書には、有効期限があります。Helpshiftはプッシュ証明書の有効期限が切れたとしてもリマインダーなどは送信しませんので、開発者自身で有効期限を定期的に確認し、プッシュ証明書を再アップロードするようにしてください。

</Admonition>

<Image
  src="/static/books/sdkx_ios/cert-expiry.png"
  width="full"
  alt="cert-expiry.png"
/>
